_format_version: "3.0"

services:
  - name: httpbin-service
    url: https://httpbin.org
    routes:
      - name: httpbin-route-main
        paths:
          - /mock
        headers:
          user:
            - b3db2b36aa26
        strip_path: true
      - name: httpbin-route-sub
        paths:
          - /mock
        strip_path: true

consumers:
  - username: admin@example.com
    keyauth_credentials:
      - key: admin-key
    acls:
      - group: admin
  - username: viewer@example.com
    keyauth_credentials:
      - key: viewer-key
    acls:
      - group: viewer

plugins:
  - name: key-auth
    service: httpbin-service
    config:
      key_names:
        - apikey
  - name: rate-limiting-advanced
    consumer: admin@example.com
    config:
      limit:
        - 10
      window_size:
        - 60
      window_type: sliding
      namespace: kong
  - name: rate-limiting-advanced
    consumer: viewer@example.com
    config:
      limit:
        - 3
      window_size:
        - 60
      window_type: sliding
      namespace: kong
  - name: acl
    service: httpbin-service
    config:
      allow:
        - admin
  - name: request-termination
    route: httpbin-route-sub
    config:
      status_code: 503
      message: "Our website is currently undergoing maintenance."
